<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>District Calculator (Debug Mode)</title>
  <style>
    body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; padding: 20px; text-align: center; background: transparent; }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      max-width: 400px;
      margin: 0 auto;
      border: 1px solid #e1e4e8;
    }
    input { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
    button { width: 100%; padding: 12px; background-color: #003366; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
    button:hover { background-color: #002244; }
    #result { margin-top: 20px; display: none; text-align: left; padding: 15px; border-radius: 8px; word-wrap: break-word; }
  </style>
</head>
<body>
  <div class="container">
    <h3 style="margin-top:0; color:#003366;">District Check (Debug)</h3>
    <p>Enter address to test connection.</p>
    
    <input type="text" id="address" placeholder="75-01 31st Ave, Queens, NY" onkeydown="if(event.key==='Enter') check()">
    <button onclick="check()">Check Address</button>
    
    <div id="result"></div>
  </div>

  <script>
    async function check() {
      const addr = document.getElementById('address').value;
      const resBox = document.getElementById('result');
      
      // --- PASTE YOUR API KEY HERE ---
      const API_KEY = 'AIzaSyAyduKVB1kDinuz3N43bUIm9CDiihkhlog'; 
      const TARGET = 'sldl:34';

      if (!addr) { alert("Enter an address"); return; }

      resBox.style.display = 'block';
      resBox.innerHTML = 'Connecting to Google...';
      resBox.style.background = '#fff'; 
      resBox.style.color = '#333';

      try {
        const url = `https://www.googleapis.com/civicinfo/v2/representatives?address=${encodeURIComponent(addr)}&includeOffices=true&levels=administrativeArea1&roles=legislatorLowerBody&key=${API_KEY}`;
        
        const response = await fetch(url);
        const data = await response.json();

        // --- ERROR CATCHER ---
        if (data.error) {
          console.error("Full Error:", data.error);
          
          let explanation = "";
          if (data.error.code === 404) explanation = "<b>Reason:</b> Google cannot find this address in the voting database. Try adding the Zip Code.";
          if (data.error.code === 403) explanation = "<b>Reason:</b> API Key is blocked. <br>1. Go to Google Cloud > Credentials.<br>2. Edit API Key.<br>3. Under 'Websites', ensure <code>https://amigias01-dot.github.io/*</code> is added exactly.";
          if (data.error.code === 400) explanation = "<b>Reason:</b> Address format is invalid.";

          resBox.innerHTML = `
            <div style="color:red; font-weight:bold;">❌ API Error: ${data.error.message}</div>
            <div style="font-size:12px; margin-top:10px; color:#555;">
              Code: ${data.error.code}<br>
              ${explanation}
            </div>
          `;
          resBox.style.background = '#fff5f5';
          resBox.style.border = '1px solid red';
          return;
        }

        // --- SUCCESS CHECK ---
        let found = false;
        let distName = "Unknown";
        
        if (data.divisions) {
          for (let id of Object.keys(data.divisions)) {
            if (id.includes('sldl:')) {
                distName = data.divisions[id].name;
                if (id.includes(TARGET)) found = true;
            }
          }
        }

        if (found) {
          resBox.innerHTML = `<b style="color:green">✅ SUCCESS: You are in District 34!</b>`;
          resBox.style.background = '#e6fffa';
        } else {
          resBox.innerHTML = `<b style="color:#c53030">❌ You are in ${distName}</b>`;
          resBox.style.background = '#fff5f5';
        }

      } catch (e) {
        resBox.innerHTML = "<b>Network Error:</b> " + e.message;
        resBox.style.background = '#fffbe6';
      }
    }
  </script>
</body>
</html>
