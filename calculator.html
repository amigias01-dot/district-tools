<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>District Check</title>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    .box {
      background: white; padding: 30px; border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto;
      border: 1px solid #ccc;
    }
    input { width: 100%; padding: 12px; margin-bottom: 10px; box-sizing: border-box; }
    button { width: 100%; padding: 12px; background: #003366; color: white; border: none; font-weight: bold; cursor: pointer; }
    button:hover { background: #002244; }
    #msg { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; text-align: left; }
    .err { background: #fff0f0; color: #d8000c; border: 1px solid #d8000c; }
    .ok { background: #eaffea; color: #005f00; border: 1px solid #005f00; }
  </style>
</head>
<body>

<div class="box">
  <h3 style="margin-top:0; color:#003366;">Am I in District 34?</h3>
  <input type="text" id="addr" placeholder="Enter your address..." onkeydown="if(event.key==='Enter') runCheck()">
  <button onclick="runCheck()">Verify</button>
  <div id="msg"></div>
</div>

<script>
  function runCheck() {
    var addr = document.getElementById('addr').value;
    var msg = document.getElementById('msg');
    // YOUR API KEY
    var KEY = 'AIzaSyAyduKVB1kDinuz3N43bUIm9CDiihkhlog';
    
    if(!addr || addr.length < 5) { alert('Enter full address'); return; }

    msg.style.display = 'block';
    msg.innerHTML = 'Searching database...';
    msg.className = '';

    // URL: Standard Endpoint + NO FILTERS (To prevent 404s)
    var url = 'https://www.googleapis.com/civicinfo/v2/representatives?address=' + encodeURIComponent(addr) + '&includeOffices=true&key=' + KEY;

    fetch(url)
      .then(function(response) { return response.json(); })
      .then(function(data) {
        
        // 1. CATCH API ERRORS
        if (data.error) {
          msg.className = 'err';
          msg.innerHTML = '<b>API Error:</b> ' + data.error.message + '<br><small>Code: ' + data.error.code + '</small>';
          return;
        }

        // 2. SEARCH FOR DISTRICT 34
        var found = false;
        var myDist = 'Unknown';

        if (data.divisions) {
          // Loop through all divisions found for this address
          for (var id in data.divisions) {
            // "sldl" = State Legislative District Lower (Assembly)
            if (id.indexOf('sldl:') !== -1) {
              myDist = data.divisions[id].name;
              if (id.indexOf('sldl:34') !== -1) {
                found = true;
              }
            }
          }
        }

        // 3. SHOW RESULT
        if (found) {
          msg.className = 'ok';
          msg.innerHTML = '<b>✅ YES! You are in District 34.</b><br><br><a href="https://secure.actblue.com/donate/andreas-migias-1" target="_blank" style="font-weight:bold;">Donate Here</a>';
        } else {
          // If we found a different district, tell them which one
          if (myDist !== 'Unknown') {
            msg.className = 'err';
            msg.innerHTML = '<b>❌ You are in ' + myDist + '.</b><br><small>You are outside District 34.</small><br><br><a href="https://secure.actblue.com/donate/andreas-migias-1" target="_blank">Donate Anyway</a>';
          } else {
            // If we found NO district (rare)
            msg.className = 'err';
            msg.innerHTML = '<b>❓ Address found, but no Assembly District data.</b><br>Try adding your Zip Code.';
          }
        }
      })
      .catch(function(err) {
        msg.className = 'err';
        msg.innerHTML = '<b>Network Error:</b> ' + err.message;
      });
  }
</script>

</body>
</html>
